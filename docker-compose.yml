version: "3.7"

services:

  nginx:
      container_name: "nginx"
      build:
        context: nginx
      restart:
        on-failure
      networks:
        - gateway
      ports:
        - 80:80
      depends_on:
        - server1
        - server2

  server1:
    container_name: server1
    networks:
      - gateway
    env_file:
      - ./flask/.env
    build : 
      context: flask
    volumes:
      - ./flask:/app
    command: 
      gunicorn -w 2 --chdir /app wsgi:app -b :8080 --log-level debug --reload

  server2:
    container_name: server2
    networks:
      - gateway
    env_file:
      - ./flask/.env
    build : 
      context: flask
    volumes:
      - ./flask:/app
    command: 
      gunicorn -w 2 --chdir /app wsgi:app -b :8080 --log-level debug --reload


networks:
  gateway: {}
